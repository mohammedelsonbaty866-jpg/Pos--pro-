<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø´Ø§Ø´Ø© Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</title>

<style>
body{font-family:tahoma;background:#f2f4f8;margin:0}
.header{background:#142850;color:#fff;padding:12px;text-align:center}
.container{padding:10px}
.btns{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.btn{background:#2f6df6;color:#fff;padding:12px;border-radius:10px;
text-align:center;font-size:13px}
.btn.red{background:#dc3545}
.btn.gray{background:#6c757d}
.btn.green{background:#28a745}
input,select{width:100%;padding:10px;margin:5px 0;border-radius:8px;border:1px solid #ccc}
table{width:100%;border-collapse:collapse;background:#fff;border-radius:10px}
th,td{padding:8px;border-bottom:1px solid #eee;text-align:center;font-size:13px}
th{background:#f6f7fb}
.total{background:#fff;padding:10px;margin-top:8px;border-radius:10px;text-align:center}
</style>
</head>

<body>

<div class="header">ğŸ§‘â€ğŸ’¼ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</div>

<div class="container">

<div class="btns">
  <div class="btn" onclick="addCustomer()">â• Ø¹Ù…ÙŠÙ„</div>
  <div class="btn gray" onclick="showStatement()">ğŸ“„ ÙƒØ´Ù Ø­Ø³Ø§Ø¨</div>
  <div class="btn red" onclick="makeReturn()">â†© Ù…Ø±ØªØ¬Ø¹</div>
  <div class="btn green" onclick="printInvoice()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</div>
</div>

<input id="customer" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<select id="saleType">
  <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
  <option value="credit">Ø¢Ø¬Ù„</option>
</select>

<input id="search" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ Ø¹Ù† Ø§Ù„ØµÙ†Ù" oninput="searchItem()">

<table>
<thead>
<tr><th>Ø§Ù„ØµÙ†Ù</th><th>ÙƒÙ…ÙŠØ©</th><th>Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>
</thead>
<tbody id="rows"></tbody>
</table>

<div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0</span></div>

<div class="btn green" onclick="saveSale()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</div>

</div>

<script>
/* ===== Ø¨ÙŠØ§Ù†Ø§Øª ===== */
let saleItems=[];
let total=0;
const rep=localStorage.getItem("currentRep")||"Ù…Ù†Ø¯ÙˆØ¨";
const stock=JSON.parse(localStorage.getItem("stock"))||[];
const sales=JSON.parse(localStorage.getItem("sales"))||[];
const returns=JSON.parse(localStorage.getItem("returns"))||[];
const customers=JSON.parse(localStorage.getItem("customers"))||[];

/* ===== Ø¨Ø­Ø« ØµÙ†Ù ===== */
function searchItem(){
  let v=search.value;
  let i=stock.find(x=>x.name.includes(v));
  if(i){saleItems.push({...i,qty:1});search.value="";render();}
}

/* ===== Ø±Ø³Ù… ===== */
function render(){
  total=0;rows.innerHTML="";
  saleItems.forEach(i=>{
    let t=i.qty*i.price;
    total+=t;
    rows.innerHTML+=`<tr>
      <td>${i.name}</td><td>${i.qty}</td>
      <td>${i.price}</td><td>${t}</td></tr>`;
  });
  document.getElementById("total").innerText=total;
}

/* ===== Ø­ÙØ¸ Ø¨ÙŠØ¹ ===== */
function saveSale(){
  if(saleType.value==="credit" && !customer.value){
    alert("Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨");return;
  }
  sales.push({
    id:Date.now(),
    rep,customer:customer.value||"Ù†Ù‚Ø¯ÙŠ",
    type:saleType.value,items:saleItems,total,
    date:new Date().toLocaleString()
  });
  saleItems.forEach(i=>{
    let s=stock.find(x=>x.name===i.name);
    if(s)s.qty-=i.qty;
  });
  localStorage.setItem("sales",JSON.stringify(sales));
  localStorage.setItem("stock",JSON.stringify(stock));
  alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
  saleItems=[];render();
}

/* ===== ÙƒØ´Ù Ø­Ø³Ø§Ø¨ ===== */
function showStatement(){
  let c=customer.value;
  let s=sales.filter(x=>x.customer===c)
             .reduce((a,b)=>a+b.total,0);
  let r=returns.filter(x=>x.customer===c)
               .reduce((a,b)=>a+b.total,0);
  alert(`ÙƒØ´Ù Ø­Ø³Ø§Ø¨ ${c}\nÙ…Ø¨ÙŠØ¹Ø§Øª: ${s}\nÙ…Ø±ØªØ¬Ø¹Ø§Øª: ${r}\nØ§Ù„Ø±ØµÙŠØ¯: ${s-r}`);
}

/* ===== Ù…Ø±ØªØ¬Ø¹ ===== */
function makeReturn(){
  if(!saleItems.length)return;
  returns.push({
    customer:customer.value,
    items:saleItems,
    total,rep,
    date:new Date().toLocaleString()
  });
  saleItems.forEach(i=>{
    let s=stock.find(x=>x.name===i.name);
    if(s)s.qty+=i.qty;
  });
  localStorage.setItem("returns",JSON.stringify(returns));
  localStorage.setItem("stock",JSON.stringify(stock));
  alert("ØªÙ… Ø§Ù„Ù…Ø±ØªØ¬Ø¹");
  saleItems=[];render();
}

/* ===== Ø·Ø¨Ø§Ø¹Ø© ===== */
function printInvoice(){window.print();}

/* ===== Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ ===== */
function addCustomer(){
  let n=prompt("Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„");
  if(!n)return;
  customers.push({name:n});
  localStorage.setItem("customers",JSON.stringify(customers));
  customer.value=n;
}
</script>

</body>
</html>
