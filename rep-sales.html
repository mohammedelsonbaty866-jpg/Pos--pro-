<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</title>

<style>
body{
  font-family:tahoma;
  background:#f2f4f8;
  margin:0
}
.header{
  background:#142850;
  color:#fff;
  padding:12px;
  text-align:center;
  font-size:18px
}
.container{padding:10px}

/* Ø£Ø²Ø±Ø§Ø± Ù…Ø±Ø¨Ø¹Ø© */
.btns{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
  margin-bottom:10px
}
.btn{
  background:#2f6df6;
  color:#fff;
  padding:14px 6px;
  border-radius:10px;
  text-align:center;
  font-size:13px;
  cursor:pointer
}
.btn.gray{background:#6c757d}
.btn.red{background:#dc3545}
.btn.green{background:#28a745}

/* Ù…Ø¯Ø®Ù„Ø§Øª */
input,select{
  width:100%;
  padding:10px;
  margin:5px 0;
  border-radius:8px;
  border:1px solid #ccc
}

/* Ø¬Ø¯ÙˆÙ„ */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:10px;
  overflow:hidden;
  font-size:13px
}
th,td{
  padding:8px;
  border-bottom:1px solid #eee;
  text-align:center
}
th{background:#f6f7fb}

.total{
  background:#fff;
  padding:10px;
  margin-top:8px;
  border-radius:10px;
  font-size:16px;
  text-align:center
}
</style>
</head>

<body>

<div class="header">ğŸ§‘â€ğŸ’¼ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</div>

<div class="container">

<!-- Ø£Ø²Ø±Ø§Ø± -->
<div class="btns">
  <div class="btn" onclick="addCustomer()">â• Ø¹Ù…ÙŠÙ„</div>
  <div class="btn gray" onclick="showStatement()">ğŸ“„ ÙƒØ´Ù Ø­Ø³Ø§Ø¨</div>
  <div class="btn red" onclick="openReturn()">â†© Ù…Ø±ØªØ¬Ø¹</div>
  <div class="btn green" onclick="printInvoice()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</div>
</div>

<!-- Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
<input id="customerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙÙŠ Ø§Ù„Ø¢Ø¬Ù„)">

<select id="saleType">
  <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
  <option value="credit">Ø¢Ø¬Ù„</option>
</select>

<!-- Ø§Ù„ØµÙ†Ù -->
<input id="itemSearch" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ Ø¹Ù† Ø§Ù„ØµÙ†Ù" oninput="searchItem()">

<table>
<thead>
<tr>
  <th>Ø§Ù„ØµÙ†Ù</th>
  <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
  <th>Ø§Ù„Ø³Ø¹Ø±</th>
  <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
</tr>
</thead>
<tbody id="items"></tbody>
</table>

<div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0</span></div>

<div class="btn green" onclick="saveSale()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</div>

</div>

<script>
/* ===== Ø¨ÙŠØ§Ù†Ø§Øª ===== */
let saleItems=[];
let total=0;
const rep=localStorage.getItem("currentRep")||"Ù…Ù†Ø¯ÙˆØ¨";

/* ===== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù ===== */
const stock=JSON.parse(localStorage.getItem("stock"))||[];

/* ===== Ø¨Ø­Ø« ØµÙ†Ù ===== */
function searchItem(){
  const v=itemSearch.value;
  const item=stock.find(i=>i.name.includes(v));
  if(item){
    addItem(item);
    itemSearch.value="";
  }
}

/* ===== Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù ===== */
function addItem(item){
  saleItems.push({
    name:item.name,
    qty:1,
    price:item.price
  });
  render();
}

/* ===== Ø±Ø³Ù… ===== */
function render(){
  total=0;
  items.innerHTML="";
  saleItems.forEach(i=>{
    let t=i.qty*i.price;
    total+=t;
    items.innerHTML+=`
      <tr>
        <td>${i.name}</td>
        <td>${i.qty}</td>
        <td>${i.price}</td>
        <td>${t}</td>
      </tr>`;
  });
  document.getElementById("total").innerText=total;
}

/* ===== Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ¹ ===== */
function saveSale(){
  const type=saleType.value;
  const customer=customerName.value||"Ù†Ù‚Ø¯ÙŠ";

  if(type==="credit" && !customer){
    alert("Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨");
    return;
  }

  const sales=JSON.parse(localStorage.getItem("sales"))||[];
  sales.push({
    id:Date.now(),
    rep,
    customer,
    type,
    items:saleItems,
    total,
    date:new Date().toLocaleString()
  });
  localStorage.setItem("sales",JSON.stringify(sales));

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
  saleItems.forEach(i=>{
    let s=stock.find(x=>x.name===i.name);
    if(s) s.qty-=i.qty;
  });
  localStorage.setItem("stock",JSON.stringify(stock));

  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
  saleItems=[];
  render();
}

/* ===== Ø·Ø¨Ø§Ø¹Ø© ===== */
function printInvoice(){
  window.print();
}

/* ===== ÙƒØ´Ù Ø­Ø³Ø§Ø¨ ===== */
function showStatement(){
  alert("ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ ÙÙ‚Ø·");
}

/* ===== Ù…Ø±ØªØ¬Ø¹ ===== */
function openReturn(){
  alert("ÙØªØ­ Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª");
}

/* ===== Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ ===== */
function addCustomer(){
  let name=prompt("Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„");
  if(!name)return;
  let customers=JSON.parse(localStorage.getItem("customers"))||[];
  customers.push({name,balance:0});
  localStorage.setItem("customers",JSON.stringify(customers));
  customerName.value=name;
}
</script>

</body>
</html>
