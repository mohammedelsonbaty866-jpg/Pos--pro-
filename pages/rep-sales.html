<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family: Arial;
  background:#f4f6f9;
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px;
  background:#1e293b;
  color:#fff;
}
.logout{
  background:#ef4444;
  color:#fff;
  border:none;
  padding:6px 10px;
  border-radius:6px;
  font-size:12px;
}
.container{
  padding:10px;
}
.card{
  background:#fff;
  border-radius:10px;
  padding:10px;
  margin-bottom:10px;
}
input,select{
  width:100%;
  padding:8px;
  margin-top:5px;
}
.row{
  display:flex;
  gap:6px;
}
.btn{
  flex:1;
  padding:12px;
  border:none;
  border-radius:8px;
  font-size:14px;
  color:#fff;
}
.blue{background:#2563eb}
.green{background:#16a34a}
.orange{background:#f97316}
.red{background:#dc2626}

table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:6px;
  border-bottom:1px solid #ddd;
  font-size:13px;
  text-align:center;
}

.footer{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#fff;
  padding:10px;
  box-shadow:0 -2px 6px rgba(0,0,0,.1);
}
</style>
</head>

<body>

<div class="header">
  <button class="logout" onclick="logout()">â‹ Ø®Ø±ÙˆØ¬</button>
  <div>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</div>
</div>

<div class="container">

<!-- Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
<div class="card">
  <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
  <input id="customerName" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ / Ù†Ù‚Ø¯ÙŠ">
  <div class="row">
    <button class="btn blue" onclick="setCash()">Ù†Ù‚Ø¯ÙŠ</button>
    <button class="btn orange" onclick="setCredit()">Ø¢Ø¬Ù„</button>
    <button class="btn green" onclick="showStatement()">ÙƒØ´Ù Ø­Ø³Ø§Ø¨</button>
  </div>
</div>

<!-- Ø§Ù„ØµÙ†Ù -->
<div class="card">
  <label>Ø§Ù„ØµÙ†Ù</label>
  <input id="itemSearch" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹">
  <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
  <input type="number" id="qty" value="1">
  <button class="btn blue" onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
</div>

<!-- Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
<div class="card">
<table>
<thead>
<tr>
<th>Ø§Ù„ØµÙ†Ù</th>
<th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
<th>Ø§Ù„Ø³Ø¹Ø±</th>
<th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
<th></th>
</tr>
</thead>
<tbody id="invoiceBody"></tbody>
</table>
<h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0</span></h3>
</div>

</div>

<div class="footer">
  <div class="row">
    <button class="btn green" onclick="printInvoice()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
    <button class="btn blue" onclick="saveInvoice()">ğŸ’¾ Ø­ÙØ¸</button>
  </div>
</div>

<script>
// ===== Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© =====
let cart=[];
let paymentType="cash";
const rep=JSON.parse(localStorage.getItem("currentRep")) || {id:1,name:"Ù…Ù†Ø¯ÙˆØ¨"};

const products=JSON.parse(localStorage.getItem("products"))||[
  {name:"Ø³ÙƒØ±",price:20,stock:100},
  {name:"Ø²ÙŠØª",price:45,stock:50}
];

// ===== Ø§Ù„Ø¹Ù…ÙŠÙ„ =====
function setCash(){
  paymentType="cash";
  document.getElementById("customerName").value="Ù†Ù‚Ø¯ÙŠ";
}
function setCredit(){
  paymentType="credit";
  document.getElementById("customerName").focus();
}
function showStatement(){
  alert("ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·");
}

// ===== Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù =====
function addItem(){
  const name=document.getElementById("itemSearch").value;
  const qty=+document.getElementById("qty").value;
  const product=products.find(p=>p.name===name);
  if(!product){alert("Ø§Ù„ØµÙ†Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");return;}
  cart.push({...product,qty});
  render();
}

// ===== Ø¹Ø±Ø¶ =====
function render(){
  const body=document.getElementById("invoiceBody");
  body.innerHTML="";
  let total=0;
  cart.forEach((i,idx)=>{
    const row=document.createElement("tr");
    const sum=i.qty*i.price;
    total+=sum;
    row.innerHTML=`
      <td>${i.name}</td>
      <td>${i.qty}</td>
      <td>${i.price}</td>
      <td>${sum}</td>
      <td><button onclick="removeItem(${idx})">âŒ</button></td>
    `;
    body.appendChild(row);
  });
  document.getElementById("total").innerText=total;
}

function removeItem(i){
  cart.splice(i,1);
  render();
}

// ===== Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (ÙŠØ¯Ø¹Ù… Ø£ÙˆÙÙ„Ø§ÙŠÙ†) =====
function saveInvoice(){
  if(cart.length===0){alert("Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙØ§Ø±ØºØ©");return;}
  if(paymentType==="credit" && !customerName.value){
    alert("Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ");
    return;
  }

  const sale={
    id:Date.now(),
    repId:rep.id,
    customer:customerName.value||"Ù†Ù‚Ø¯ÙŠ",
    payment:paymentType,
    items:cart,
    total:+document.getElementById("total").innerText,
    date:new Date().toISOString()
  };

  let pending=JSON.parse(localStorage.getItem("pendingSales"))||[];

  if(!navigator.onLine){
    pending.push(sale);
    localStorage.setItem("pendingSales",JSON.stringify(pending));
    alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª");
  }else{
    saveToSystem(sale);
  }

  cart=[];
  render();
}

// ===== Ø±Ø¨Ø· Ø§Ù„Ø³ÙŠØ³ØªÙ… =====
function saveToSystem(sale){
  let sales=JSON.parse(localStorage.getItem("sales"))||[];
  sales.push(sale);
  localStorage.setItem("sales",JSON.stringify(sales));
}

// ===== Ø±ÙØ¹ Ø§Ù„Ù…Ø¤Ø¬Ù„ =====
window.addEventListener("online",()=>{
  let pending=JSON.parse(localStorage.getItem("pendingSales"))||[];
  pending.forEach(s=>saveToSystem(s));
  localStorage.removeItem("pendingSales");
});

// ===== Ø·Ø¨Ø§Ø¹Ø© =====
function printInvoice(){
  window.print();
}

// ===== Ø®Ø±ÙˆØ¬ =====
function logout(){
  localStorage.removeItem("currentRep");
  location.href="../index.html";
}
</script>

</body>
</html>
