<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</title>

<style>
body{
  font-family:tahoma;
  background:#f2f4f8;
  margin:0
}
.header{
  background:#2f6df6;
  color:#fff;
  padding:12px;
  text-align:center;
  font-size:18px
}
.box{
  background:#fff;
  margin:8px;
  padding:10px;
  border-radius:10px
}
input,select{
  width:100%;
  padding:10px;
  margin:5px 0;
  font-size:14px
}
.btn-grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:6px
}
.btn{
  border:0;
  border-radius:8px;
  padding:12px 5px;
  font-size:13px;
  color:#fff;
  background:#2f6df6
}
.btn.green{background:#28a745}
.btn.red{background:#dc3545}
.btn.gray{background:#6c757d}

table{
  width:100%;
  border-collapse:collapse;
  font-size:13px
}
th,td{
  border-bottom:1px solid #ddd;
  padding:6px;
  text-align:center
}
.hidden{display:none}
</style>
</head>

<body>

<div class="header">Ø´Ø§Ø´Ø© Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</div>

<!-- ===== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨ÙŠØ¹ ===== -->
<div class="box">
  <input id="customer" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙÙŠ Ø§Ù„Ø¢Ø¬Ù„)">
  <select id="saleType">
    <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
    <option value="credit">Ø¢Ø¬Ù„</option>
  </select>
</div>

<!-- ===== Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù ===== -->
<div class="box">
  <input id="itemName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
  <input id="qty" type="number" value="1" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
  <!-- Ø§Ù„Ø³Ø¹Ø± Ù…ÙØªÙˆØ­ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ -->
  <input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
  <input id="discount" type="number" value="0" placeholder="Ø®ØµÙ…">
  <button class="btn" onclick="addItem()">â• Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
</div>

<!-- ===== Ø§Ù„ÙØ§ØªÙˆØ±Ø© ===== -->
<div class="box">
  <table>
    <thead>
      <tr>
        <th>Ø§Ù„ØµÙ†Ù</th>
        <th>Ùƒ</th>
        <th>Ø³</th>
        <th>Ø®ØµÙ…</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
      </tr>
    </thead>
    <tbody id="invoiceBody"></tbody>
  </table>
  <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0</span></h3>
</div>

<!-- ===== Ø£Ø²Ø±Ø§Ø± ===== -->
<div class="box btn-grid">
  <button class="btn green" onclick="saveSale()">ğŸ’¾ Ø­ÙØ¸</button>
  <button class="btn" onclick="printInvoice()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
  <button class="btn red" onclick="toggleReturn()">â†© Ù…Ø±ØªØ¬Ø¹</button>
  <button class="btn gray" onclick="showStatement()">ğŸ“‘ ÙƒØ´Ù Ø­Ø³Ø§Ø¨</button>
</div>

<!-- ===== Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª ===== -->
<div class="box hidden" id="returnBox">
  <h3>Ù…Ø±ØªØ¬Ø¹</h3>
  <input id="rItem" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
  <input id="rQty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
  <input id="rPrice" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
  <button class="btn red" onclick="saveReturn()">Ø­ÙØ¸ Ø§Ù„Ù…Ø±ØªØ¬Ø¹</button>
</div>

<!-- ===== ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ ===== -->
<div class="box hidden" id="statementBox">
  <h3>ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
  <div id="statementData"></div>
</div>

<script>
/* ========= ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ========= */
let sales = JSON.parse(localStorage.getItem("sales")) || [];
let returns = JSON.parse(localStorage.getItem("returns")) || [];
let stock = JSON.parse(localStorage.getItem("stock")) || {};
let cashbox = JSON.parse(localStorage.getItem("cashbox")) || 0;

/* ========= Ø§Ù„ÙØ§ØªÙˆØ±Ø© ========= */
let invoice = [];
let total = 0;

/* ========= Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù ========= */
function addItem(){
  if(!itemName.value || !price.value) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„ØµÙ†Ù ÙˆØ§Ù„Ø³Ø¹Ø±");

  invoice.push({
    name:itemName.value,
    qty:+qty.value,
    price:+price.value,
    discount:+discount.value
  });
  renderInvoice();
}

/* ========= Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ========= */
function renderInvoice(){
  invoiceBody.innerHTML="";
  total=0;

  invoice.forEach(i=>{
    const rowTotal=(i.qty*i.price)-i.discount;
    total+=rowTotal;

    invoiceBody.innerHTML+=`
      <tr>
        <td>${i.name}</td>
        <td>${i.qty}</td>
        <td>${i.price}</td>
        <td>${i.discount}</td>
        <td>${rowTotal}</td>
      </tr>
    `;
  });

  document.getElementById("total").innerText=total;
}

/* ========= Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ¹ ========= */
function saveSale(){
  if(invoice.length===0) return alert("Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙØ§Ø¶ÙŠØ©");
  if(saleType.value==="credit" && !customer.value)
    return alert("Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¢Ø¬Ù„");

  sales.push({
    id:Date.now(),
    customer:customer.value||"Ù†Ù‚Ø¯ÙŠ",
    type:saleType.value,
    items:invoice,
    total,
    date:new Date().toLocaleString()
  });

  invoice.forEach(i=>{
    stock[i.name]=(stock[i.name]||0)-i.qty;
  });

  if(saleType.value==="cash") cashbox+=total;

  localStorage.setItem("sales",JSON.stringify(sales));
  localStorage.setItem("stock",JSON.stringify(stock));
  localStorage.setItem("cashbox",cashbox);

  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
  invoice=[];
  renderInvoice();
}

/* ========= Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª ========= */
function toggleReturn(){
  returnBox.classList.toggle("hidden");
}

function saveReturn(){
  if(!rItem.value || !rQty.value || !rPrice.value)
    return alert("Ø§ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¬Ø¹");

  const totalR = rQty.value*rPrice.value;

  returns.push({
    id:Date.now(),
    customer:customer.value,
    item:rItem.value,
    qty:+rQty.value,
    price:+rPrice.value,
    total:totalR,
    date:new Date().toLocaleString()
  });

  stock[rItem.value]=(stock[rItem.value]||0)+(+rQty.value);
  cashbox-=totalR;

  localStorage.setItem("returns",JSON.stringify(returns));
  localStorage.setItem("stock",JSON.stringify(stock));
  localStorage.setItem("cashbox",cashbox);

  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø±ØªØ¬Ø¹");
}

/* ========= ÙƒØ´Ù Ø­Ø³Ø§Ø¨ ========= */
function showStatement(){
  if(!customer.value) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„");

  statementBox.classList.remove("hidden");

  let html="";
  let balance=0;

  sales.filter(s=>s.customer===customer.value)
    .forEach(s=>{
      balance+=s.total;
      html+=`<p>ÙØ§ØªÙˆØ±Ø©: ${s.total}</p>`;
    });

  returns.filter(r=>r.customer===customer.value)
    .forEach(r=>{
      balance-=r.total;
      html+=`<p>Ù…Ø±ØªØ¬Ø¹: ${r.total}</p>`;
    });

  html+=`<h4>Ø§Ù„Ø±ØµÙŠØ¯: ${balance}</h4>`;
  statementData.innerHTML=html;
}

/* ========= Ø·Ø¨Ø§Ø¹Ø© ========= */
function printInvoice(){
  window.print();
}
</script>

</body>
</html>
