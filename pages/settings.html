<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>مبيعات</title>
<style>
body{font-family:tahoma;background:#f4f6fa;margin:0}
.header{background:#2f6df6;color:#fff;padding:12px;text-align:center}
.box{background:#fff;margin:8px;padding:10px;border-radius:10px}
.btns{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:6px
}
.btn{
  padding:12px;
  border:0;
  border-radius:8px;
  font-size:14px;
  background:#2f6df6;
  color:#fff
}
.btn.red{background:#dc3545}
.btn.green{background:#28a745}
input,select{
  width:100%;
  padding:10px;
  margin:4px 0
}
table{width:100%;font-size:13px}
td,th{text-align:center;padding:4px}
</style>
</head>

<body>

<div class="header">شاشة المبيعات</div>

<div class="box">
  <input id="customer" placeholder="اسم العميل">
  <select id="type">
    <option value="cash">نقدي</option>
    <option value="credit">آجل</option>
  </select>
</div>

<div class="box">
  <input id="item" placeholder="بحث سريع عن الصنف">
  <input id="qty" type="number" value="1">
  <input id="price" placeholder="السعر">
  <button class="btn" onclick="addItem()">إضافة صنف</button>
</div>

<div class="box">
  <table border="1">
    <thead>
      <tr><th>الصنف</th><th>ك</th><th>س</th><th>إجمالي</th></tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>
  <h3>الإجمالي: <span id="total">0</span></h3>
</div>

<div class="box btns">
  <button class="btn green" onclick="saveSale()">حفظ</button>
  <button class="btn" onclick="printInv()">طباعة</button>
  <button class="btn red" onclick="openReturn()">مرتجع</button>
  <button class="btn" onclick="openStatement()">كشف حساب</button>
</div>

<script>
let items = JSON.parse(localStorage.getItem("items"))||[];
let sales = JSON.parse(localStorage.getItem("sales"))||[];
let stock = JSON.parse(localStorage.getItem("stock"))||{};
let cash = JSON.parse(localStorage.getItem("cashbox"))||0;

let invoice=[];
let total=0;

function addItem(){
  const name=item.value;
  const q=+qty.value;
  const p=+price.value;
  invoice.push({name,qty:q,price:p});
  render();
}

function render(){
  rows.innerHTML="";
  total=0;
  invoice.forEach(i=>{
    const t=i.qty*i.price;
    total+=t;
    rows.innerHTML+=`
      <tr><td>${i.name}</td><td>${i.qty}</td><td>${i.price}</td><td>${t}</td></tr>
    `;
  });
  document.getElementById("total").innerText=total;
}

function saveSale(){
  if(invoice.length===0)return alert("فاتورة فاضية");
  if(type.value==="credit" && !customer.value)
    return alert("اسم العميل مطلوب");

  sales.push({
    id:Date.now(),
    customer:customer.value||"نقدي",
    type:type.value,
    items:invoice,
    total,
    date:new Date().toLocaleString()
  });

  invoice.forEach(i=>{
    stock[i.name]=(stock[i.name]||0)-i.qty;
  });

  if(type.value==="cash") cash+=total;

  localStorage.setItem("sales",JSON.stringify(sales));
  localStorage.setItem("stock",JSON.stringify(stock));
  localStorage.setItem("cashbox",cash);

  alert("تم الحفظ");
  invoice=[];
  render();
}

function printInv(){window.print();}
function openReturn(){location.href="returns.html";}
function openStatement(){
  localStorage.setItem("statementCustomer",customer.value);
  location.href="statement.html";
}
  <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>كشف حساب</title>
</head>
<body>

<h2>كشف حساب العميل</h2>
<div id="data"></div>

<script>
const name=localStorage.getItem("statementCustomer");
const sales=JSON.parse(localStorage.getItem("sales"))||[];
const returns=JSON.parse(localStorage.getItem("returns"))||[];

let html=`<h3>${name}</h3>`;
let bal=0;

sales.filter(s=>s.customer===name).forEach(s=>{
  bal+=s.total;
  html+=`<p>فاتورة ${s.total}</p>`;
});

returns.filter(r=>r.customer===name).forEach(r=>{
  bal-=r.total;
  html+=`<p>مرتجع ${r.total}</p>`;
});

html+=`<h3>الرصيد: ${bal}</h3>`;
data.innerHTML=html;
</script>
<script>
let returns=JSON.parse(localStorage.getItem("returns"))||[];
let stock=JSON.parse(localStorage.getItem("stock"))||{};

function saveReturn(item,qty,price,customer){
  returns.push({
    id:Date.now(),
    item,qty,price,
    total:qty*price,
    customer
  });

  stock[item]=(stock[item]||0)+qty;

  localStorage.setItem("returns",JSON.stringify(returns));
  localStorage.setItem("stock",JSON.stringify(stock));
}
</script>
</body>
</html>
</script>
</body>
</html>
