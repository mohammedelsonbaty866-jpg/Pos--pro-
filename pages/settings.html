<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</title>

<!-- ===== Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù…Ù†ÙŠÙˆ ===== -->
<link rel="stylesheet" href="../css/menu.css">

<!-- Ù…ÙƒØªØ¨Ø© Excel -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body{background:#f2f4f8}
.page{padding:15px}
.card{
  background:#fff;
  border-radius:14px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 2px 6px rgba(0,0,0,.08)
}
h3{margin-bottom:10px}
input,button{
  width:100%;
  padding:12px;
  margin:6px 0;
  font-size:16px;
  border-radius:8px;
  border:1px solid #ddd
}
button{
  background:#2f6df6;
  color:#fff;
  border:0
}
button.gray{background:#6c757d}
button.danger{background:#d9534f}
label{font-size:14px}
</style>
</head>

<body>

<!-- ===== Ø§Ù„Ù…Ù†ÙŠÙˆ ===== -->
<div class="sidebar" id="sidebar">
  <div class="menu-item" onclick="go('sales.html')">ğŸ§¾ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
  <div class="menu-item" onclick="go('purchases.html')">ğŸ“¦ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
  <div class="menu-item" onclick="go('items.html')">ğŸ“‹ Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
  <div class="menu-item" onclick="go('customers.html')">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
  <div class="menu-item" onclick="go('suppliers.html')">ğŸ­ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</div>
  <div class="menu-item" onclick="go('reports.html')">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
  <div class="menu-item active">âš™ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
  <div class="menu-toggle" onclick="toggleMenu()">â¬…</div>
</div>

<!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ===== -->
<div class="main-content">
<div class="page">

<!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± -->
<div class="card">
  <h3>ğŸª Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h3>
  <input id="storeName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±">
  <input id="storePhone" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†">
  <button onclick="saveStore()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
</div>

<!-- Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ -->
<div class="card">
  <h3>ğŸ§‘â€ğŸ’¼ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</h3>
  <input id="repName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨">
  <input id="repUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
  <input type="password" id="repPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <label>
    <input type="checkbox" onclick="togglePass()"> Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
  </label>
  <button onclick="addRep()">Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨</button>
  <button class="danger" onclick="removeRep()">Ø­Ø°Ù Ù…Ù†Ø¯ÙˆØ¨ (Ø¨Ø§Ù„ÙŠÙˆØ²Ø±)</button>
</div>

<!-- ÙƒØ´ÙˆÙ Ø§Ù„Ø­Ø³Ø§Ø¨ -->
<div class="card">
  <h3>ğŸ“‘ ÙƒØ´ÙˆÙ Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
  <button onclick="go('customer-statement.html')">ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø¹Ù…ÙŠÙ„</button>
  <button onclick="go('supplier-statement.html')">ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ù…ÙˆØ±Ø¯</button>
</div>

<!-- Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
<div class="card">
  <h3>ğŸ–¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</h3>
  <button onclick="printBluetooth()">Ø·Ø¨Ø§Ø¹Ø© Ø¨Ù„ÙˆØªÙˆØ« Ø³Ø±ÙŠØ¹Ø©</button>
  <button class="gray" onclick="printPDF()">ØªØ­Ù…ÙŠÙ„ / Ø·Ø¨Ø§Ø¹Ø© PDF</button>
</div>

<!-- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
<div class="card">
  <h3>ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
  <button onclick="exportExcel()">ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel Ø­Ù‚ÙŠÙ‚ÙŠ</button>
</div>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ -->
<div class="card">
  <button class="danger" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
</div>

</div>
</div>

<!-- ===== JS ===== -->
<script src="../js/menu.js"></script>

<script>
/* ===== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± ===== */
function saveStore(){
  localStorage.setItem("store",JSON.stringify({
    name:storeName.value,
    phone:storePhone.value
  }));
  alert("ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±");
}

(function(){
  const s=JSON.parse(localStorage.getItem("store"));
  if(s){
    storeName.value=s.name||"";
    storePhone.value=s.phone||"";
  }
})();

/* ===== Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ ===== */
function togglePass(){
  repPass.type = repPass.type==="password"?"text":"password";
}

function addRep(){
  let reps=JSON.parse(localStorage.getItem("reps"))||[];
  reps.push({
    id:Date.now(),
    name:repName.value,
    username:repUser.value,
    password:repPass.value
  });
  localStorage.setItem("reps",JSON.stringify(reps));
  alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨");
}

function removeRep(){
  let reps=JSON.parse(localStorage.getItem("reps"))||[];
  reps=reps.filter(r=>r.username!==repUser.value);
  localStorage.setItem("reps",JSON.stringify(reps));
  alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨");
}

/* ===== ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ===== */
function logout(){
  localStorage.removeItem("currentRep");
  location.href="login.html";
}

/* ===== Excel Ø­Ù‚ÙŠÙ‚ÙŠ ===== */
function exportExcel(){
  const wb=XLSX.utils.book_new();

  function add(name,data){
    const ws=XLSX.utils.json_to_sheet(data);
    XLSX.utils.book_append_sheet(wb,ws,name);
  }

  add("Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª",JSON.parse(localStorage.getItem("sales"))||[]);
  add("Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª",JSON.parse(localStorage.getItem("purchases"))||[]);
  add("Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",JSON.parse(localStorage.getItem("customers"))||[]);
  add("Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†",JSON.parse(localStorage.getItem("suppliers"))||[]);
  add("Ø§Ù„Ø£ØµÙ†Ø§Ù",JSON.parse(localStorage.getItem("items"))||[]);
  add("Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨",JSON.parse(localStorage.getItem("reps"))||[]);

  XLSX.writeFile(wb,"system-data.xlsx");
}

/* ===== Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ===== */

// Ø·Ø¨Ø§Ø¹Ø© Ø¨Ù„ÙˆØªÙˆØ« (Ù…ÙˆØ¨Ø§ÙŠÙ„ / POS)
function printBluetooth() {
  window.print();
}

// Ø·Ø¨Ø§Ø¹Ø© / ØªØ­Ù…ÙŠÙ„ PDF Ø­Ù‚ÙŠÙ‚ÙŠ
function printPDF(title = "ÙØ§ØªÙˆØ±Ø© / ØªÙ‚Ø±ÙŠØ±") {
  const w = window.open("", "_blank");

  w.document.write(`
    <!DOCTYPE html>
    <html lang="ar" dir="rtl">
    <head>
      <meta charset="UTF-8">
      <title>${title}</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          padding: 20px;
        }
        h2 {
          text-align: center;
          margin-bottom: 10px;
        }
        p {
          text-align: center;
          font-size: 14px;
        }
        @media print {
          body {
            margin: 0;
          }
        }
      </style>
    </head>
    <body>
      <h2>${title}</h2>
      <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleString()}</p>

      <script>
        window.onload = function () {
          window.print();
        }
      <\/script>
    </body>
    </html>
  `);

  w.document.close();
}
