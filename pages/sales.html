<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</title>

  <link rel="stylesheet" href="../css/menu.css">

  <style>
    body { background:#f4f6f9; }
    .page { padding:20px; }
    .card {
      background:#fff;
      padding:15px;
      border-radius:12px;
      margin-bottom:15px;
    }
    .row {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:10px;
    }
    input, select {
      padding:10px;
      border-radius:8px;
      border:1px solid #ccc;
      width:100%;
    }
    button {
      padding:10px;
      border:none;
      border-radius:8px;
      background:#2f6df6;
      color:#fff;
      cursor:pointer;
    }
    table {
      width:100%;
      border-collapse:collapse;
    }
    th,td {
      padding:8px;
      border-bottom:1px solid #ddd;
      text-align:center;
    }
    th { background:#f1f3f6; }
    .total {
      font-size:20px;
      font-weight:bold;
      margin-top:10px;
      text-align:left;
    }
  </style>
</head>

<body>

<!-- ===== Ø§Ù„Ù…Ù†ÙŠÙˆ ===== -->
<div class="sidebar" id="sidebar">
  <div class="menu-item active" onclick="go('sales.html')">ğŸ§¾ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
  <div class="menu-item" onclick="go('purchases.html')">ğŸ“¦ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
  <div class="menu-item" onclick="go('items.html')">ğŸ“‹ Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
  <div class="menu-item" onclick="go('customers.html')">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
  <div class="menu-item" onclick="go('suppliers.html')">ğŸ­ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</div>
  <div class="menu-item" onclick="go('stock.html')">ğŸ“Š Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
  <div class="menu-item" onclick="go('reports.html')">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
  <div class="menu-item" onclick="go('settings.html')">âš™ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
  <div class="menu-toggle" onclick="toggleMenu()">â¬…</div>
</div>

<!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ===== -->
<div class="main-content">
<div class="page">

<h2>ğŸ§¾ Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>

<!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨ÙŠØ¹ -->
<div class="card">
  <div class="row">
    <select id="saleType">
      <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
      <option value="credit">Ø¢Ø¬Ù„</option>
    </select>

    <select id="customerSelect">
      <option value="">-- Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ --</option>
    </select>

    <input type="number" id="discount" placeholder="Ø®ØµÙ…">
  </div>
</div>

<!-- Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù -->
<div class="card">
  <div class="row">
    <select id="itemSelect"></select>
    <input type="number" id="qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" value="1">
    <input type="number" id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±">
    <button onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
  </div>
</div>

<!-- Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
<div class="card">
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Ø§Ù„ØµÙ†Ù</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø§Ù„Ø³Ø¹Ø±</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
        <th>âŒ</th>
      </tr>
    </thead>
    <tbody id="invoiceBody"></tbody>
  </table>

  <div class="total">
    Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0</span> Ø¬Ù†ÙŠÙ‡
  </div>

  <br>
  <button onclick="saveSale()">ğŸ’¾ Ø­ÙØ¸</button>
  <button onclick="window.print()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
</div>

</div>
</div>

<script src="../js/menu.js"></script>

<script>
let invoice = [];
let total = 0;

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
const customers = JSON.parse(localStorage.getItem("customers")) || [];
customers.forEach(c => {
  customerSelect.innerHTML += `<option value="${c.name}">${c.name}</option>`;
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù
const items = JSON.parse(localStorage.getItem("items")) || [];
items.forEach(i => {
  itemSelect.innerHTML += `<option value="${i.name}">${i.name}</option>`;
});

// Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØµÙ†Ù
itemSelect.onchange = () => {
  const item = items.find(i => i.name === itemSelect.value);
  if (item) price.value = item.price;
};

function addItem() {
  const name = itemSelect.value;
  const q = Number(qty.value);
  const p = Number(price.value);

  if (!name || q <= 0 || p <= 0) return alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©");

  invoice.push({ name, qty:q, price:p, total:q*p });
  render();
}

function render() {
  invoiceBody.innerHTML = "";
  total = 0;

  invoice.forEach((i, index) => {
    total += i.total;
    invoiceBody.innerHTML += `
      <tr>
        <td>${index+1}</td>
        <td>${i.name}</td>
        <td>${i.qty}</td>
        <td>${i.price}</td>
        <td>${i.total}</td>
        <td><button onclick="removeItem(${index})">âŒ</button></td>
      </tr>`;
  });

  total -= Number(discount.value || 0);
  document.getElementById("total").innerText = total;
}

function removeItem(i) {
  invoice.splice(i,1);
  render();
}

function saveSale() {
  if (invoice.length === 0) return alert("Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙØ§Ø¶ÙŠØ©");

  const type = saleType.value;
  const customer = type === "credit" ? customerSelect.value : "Ù†Ù‚Ø¯ÙŠ";
  if (type === "credit" && !customer) return alert("Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„");

  // Ø­ÙØ¸ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
  const sales = JSON.parse(localStorage.getItem("sales")) || [];
  sales.push({
    id:Date.now(),
    type,
    customer,
    items:invoice,
    total,
    date:new Date().toLocaleString()
  });
  localStorage.setItem("sales",JSON.stringify(sales));

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
  let stock = JSON.parse(localStorage.getItem("stock")) || {};
  invoice.forEach(i=>{
    stock[i.name]=(stock[i.name]||0)-i.qty;
  });
  localStorage.setItem("stock",JSON.stringify(stock));

  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
  invoice=[];
  render();
}
</script>

</body>
</html>
