<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… POS Ù…ØªÙƒØ§Ù…Ù„</title>

<style>
body{margin:0;font-family:Tahoma;background:#f4f6f9}
.sidebar{position:fixed;right:0;top:0;width:260px;height:100vh;background:#142850;padding:10px;color:#fff}
.menu-item{background:#1b2d4a;margin-bottom:8px;padding:12px;border-radius:10px;cursor:pointer}
.menu-item:hover{background:#284b8f}
.main{margin-right:260px;padding:20px}
.card{background:#fff;padding:15px;border-radius:12px;margin-bottom:15px}
.row{display:flex;gap:10px;flex-wrap:wrap}
input,select,button{padding:8px;border-radius:8px;border:1px solid #ccc}
button{background:#2f6df6;color:#fff;border:none;cursor:pointer}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#eee}
hr{margin:30px 0}
</style>
</head>

<body>

<!-- ===== MENU ===== -->
<div class="sidebar">
  <div class="menu-item">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
  <div class="menu-item">Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
  <div class="menu-item">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
</div>

<div class="main">

<!-- ===================== Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ===================== -->
<h2>Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>

<div class="card">
  <div class="row">
    <select id="paymentType">
      <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
      <option value="credit">Ø¢Ø¬Ù„</option>
    </select>
    <input id="customerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
    <select id="agentName"></select>
  </div>
</div>

<div class="card">
  <input id="productName" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙ†Ù" list="productsList">
  <datalist id="productsList"></datalist>

  <div class="row">
    <select id="unit"></select>
    <input type="number" id="qty" value="1">
    <button onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
  </div>
</div>

<div class="card">
  <button onclick="saveSale()">ğŸ’¾ Ø­ÙØ¸</button>
  <button onclick="window.print()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>

  <table>
    <thead>
      <tr>
        <th>Ø§Ù„ØµÙ†Ù</th>
        <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø§Ù„Ø³Ø¹Ø±</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
      </tr>
    </thead>
    <tbody id="invoice"></tbody>
  </table>

  <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0</span></h3>
</div>

<hr>

<!-- ===================== Ø§Ù„Ø£ØµÙ†Ø§Ù ===================== -->
<h2>Ø´Ø§Ø´Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</h2>

<div class="card">
  <input id="prodName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">

  <div class="row">
    <select id="prodUnit">
      <option>ÙƒÙŠÙ„Ùˆ</option>
      <option>Ø¹Ù„Ø¨Ø©</option>
      <option>ÙƒØ±ØªÙˆÙ†Ø©</option>
      <option>Ø¨Ø§ÙƒÙŠØª</option>
    </select>

    <input type="number" id="prodPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
    <input type="number" id="prodStock" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø¨Ø§Ù„Ù…Ø®Ø²Ù†">
  </div>

  <button onclick="addOrUpdateProduct()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù</button>
</div>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>Ø§Ù„ØµÙ†Ù</th>
        <th>Ø§Ù„ÙˆØ­Ø¯Ø§Øª / Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</th>
        <th>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th>
      </tr>
    </thead>
    <tbody id="productsTable"></tbody>
  </table>
</div>

<hr>

<!-- ===================== Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ===================== -->
<h2>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
        <th>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
      </tr>
    </thead>
    <tbody id="salesReport"></tbody>
  </table>
</div>

</div>

<script>
// ===================== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =====================
let products = JSON.parse(localStorage.getItem("products")) || [];
let sales = JSON.parse(localStorage.getItem("sales")) || [];
let agents = ["Ø£Ø­Ù…Ø¯","Ù…Ø­Ù…Ø¯","Ø¹Ù„ÙŠ"];

localStorage.setItem("agents",JSON.stringify(agents));

// ===================== ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø¯Ø¦ÙŠ =====================
agents.forEach(a=>{
  agentName.innerHTML+=`<option>${a}</option>`;
});

function refreshProductsList(){
  productsList.innerHTML="";
  products.forEach(p=>{
    productsList.innerHTML+=`<option value="${p.name}">`;
  });
}
refreshProductsList();

// ===================== Ø§Ù„Ø£ØµÙ†Ø§Ù =====================
function addOrUpdateProduct(){
  const name = prodName.value.trim();
  const unit = prodUnit.value;
  const price = +prodPrice.value;
  const stock = +prodStock.value;

  if(!name || price<=0 || stock<0){
    alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    return;
  }

  let product = products.find(p=>p.name===name);
  if(!product){
    product={id:Date.now(),name,units:{}};
    products.push(product);
  }

  product.units[unit]={price,stock};
  saveProducts();
  renderProducts();
  refreshProductsList();
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù");
}

function saveProducts(){
  localStorage.setItem("products",JSON.stringify(products));
}

function renderProducts(){
  productsTable.innerHTML="";
  products.forEach(p=>{
    let u="",s="";
    for(let k in p.units){
      u+=`${k}: ${p.units[k].price}<br>`;
      s+=`${k}: ${p.units[k].stock}<br>`;
    }
    productsTable.innerHTML+=`
      <tr>
        <td>${p.name}</td>
        <td>${u}</td>
        <td>${s}</td>
      </tr>`;
  });
}
renderProducts();

// ===================== Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª =====================
let items=[];

productName.onchange=()=>{
  let p=products.find(x=>x.name===productName.value);
  unit.innerHTML="";
  if(!p)return;
  for(let k in p.units){
    unit.innerHTML+=`<option>${k}</option>`;
  }
};

function addItem(){
  let p=products.find(x=>x.name===productName.value);
  if(!p)return alert("Ø§Ù„ØµÙ†Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");

  let u=unit.value;
  let q=+qty.value;
  if(p.units[u].stock<q)return alert("Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØºÙŠØ± ÙƒØ§ÙÙŠ");

  items.push({
    name:p.name,
    unit:u,
    qty:q,
    price:p.units[u].price
  });
  renderInvoice();
}

function renderInvoice(){
  invoice.innerHTML="";
  let t=0;
  items.forEach(i=>{
    let r=i.qty*i.price;
    t+=r;
    invoice.innerHTML+=`
      <tr>
        <td>${i.name}</td>
        <td>${i.unit}</td>
        <td>${i.qty}</td>
        <td>${i.price}</td>
        <td>${r}</td>
      </tr>`;
  });
  total.innerText=t;
}

function saveSale(){
  if(items.length===0)return alert("ÙØ§ØªÙˆØ±Ø© ÙØ§Ø¶ÙŠØ©");
  if(paymentType.value==="credit" && !customerName.value)
    return alert("Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨");

  items.forEach(i=>{
    let p=products.find(x=>x.name===i.name);
    p.units[i.unit].stock-=i.qty;
  });

  sales.push({
    date:new Date().toLocaleString(),
    customer:customerName.value||"Ù†Ù‚Ø¯ÙŠ",
    agent:agentName.value,
    total:total.innerText
  });

  saveProducts();
  localStorage.setItem("sales",JSON.stringify(sales));
  renderReport();

  items=[];
  renderInvoice();
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
}

// ===================== Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± =====================
function renderReport(){
  salesReport.innerHTML="";
  sales.forEach(s=>{
    salesReport.innerHTML+=`
      <tr>
        <td>${s.date}</td>
        <td>${s.customer}</td>
        <td>${s.agent}</td>
        <td>${s.total}</td>
      </tr>`;
  });
}
renderReport();
</script>

</body>
</html>
