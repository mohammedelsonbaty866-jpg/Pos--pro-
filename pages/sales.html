<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ù…Ø¨ÙŠØ¹Ø§Øª Ù…ØªÙƒØ§Ù…Ù„</title>

<style>
body{margin:0;font-family:Tahoma;background:#f4f6f9}
.sidebar{position:fixed;right:0;top:0;width:260px;height:100vh;background:#142850;padding:10px;color:#fff}
.menu-item{background:#1b2d4a;margin-bottom:8px;padding:12px;border-radius:10px;cursor:pointer}
.menu-item:hover{background:#284b8f}
.main{margin-right:260px;padding:20px}
.card{background:#fff;padding:15px;border-radius:12px;margin-bottom:15px}
.row{display:flex;gap:10px;flex-wrap:wrap}
input,select,button{padding:8px;border-radius:8px;border:1px solid #ccc}
button{background:#2f6df6;color:#fff;border:none;cursor:pointer}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#eee}
</style>
</head>

<body>

<!-- ===== MENU ===== -->
<div class="sidebar">
  <div class="menu-item">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
  <div class="menu-item">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
  <div class="menu-item">Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
  <div class="menu-item">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
  <div class="menu-item">Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</div>
  <div class="menu-item">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
</div>

<div class="main">

<h2>Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>

<div class="card">
  <div class="row">
    <select id="paymentType">
      <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
      <option value="credit">Ø¢Ø¬Ù„</option>
    </select>

    <input id="customerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
    <select id="agentName"></select>
  </div>
</div>

<div class="card">
  <input id="productName" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙ†Ù" list="productsList">
  <datalist id="productsList"></datalist>

  <div class="row">
    <select id="unit"></select>
    <input type="number" id="qty" value="1">
    <button onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
  </div>
</div>

<div class="card">
  <button onclick="saveSale()">ğŸ’¾ Ø­ÙØ¸</button>
  <button onclick="window.print()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>

  <table>
    <thead>
      <tr>
        <th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
      </tr>
    </thead>
    <tbody id="invoice"></tbody>
  </table>

  <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0</span></h3>
</div>

</div>

<script>
// ===== Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª =====
let products = JSON.parse(localStorage.getItem("products")) || [
 {name:"Ø³ÙƒØ±",prices:{ÙƒÙŠÙ„Ùˆ:30,ÙƒØ±ØªÙˆÙ†Ø©:280},stock:{ÙƒÙŠÙ„Ùˆ:100,ÙƒØ±ØªÙˆÙ†Ø©:10}},
 {name:"Ø£Ø±Ø²",prices:{ÙƒÙŠÙ„Ùˆ:25},stock:{ÙƒÙŠÙ„Ùˆ:200}}
];

let customers = JSON.parse(localStorage.getItem("customers")) || [];
let agents = JSON.parse(localStorage.getItem("agents")) || ["Ø£Ø­Ù…Ø¯","Ù…Ø­Ù…Ø¯"];
let sales = JSON.parse(localStorage.getItem("sales")) || [];

localStorage.setItem("products",JSON.stringify(products));

// ===== ØªØ­Ù…ÙŠÙ„ =====
products.forEach(p=>{
  productsList.innerHTML+=`<option value="${p.name}">`;
});
agents.forEach(a=>{
  agentName.innerHTML+=`<option>${a}</option>`;
});

// ===== Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª =====
let items=[];

productName.onchange=()=>{
  let p=products.find(x=>x.name==productName.value);
  unit.innerHTML="";
  if(!p)return;
  Object.keys(p.prices).forEach(u=>{
    unit.innerHTML+=`<option>${u}</option>`;
  });
};

function addItem(){
  let p=products.find(x=>x.name==productName.value);
  if(!p)return alert("Ø§Ù„ØµÙ†Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");

  let u=unit.value;
  let q=+qty.value;
  if(p.stock[u]<q)return alert("Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØºÙŠØ± ÙƒØ§ÙÙŠ");

  let price=p.prices[u];
  items.push({name:p.name,unit:u,qty:q,price});
  render();
}

function render(){
  invoice.innerHTML="";
  let t=0;
  items.forEach(i=>{
    let row=i.qty*i.price;
    t+=row;
    invoice.innerHTML+=`
      <tr>
        <td>${i.name}</td>
        <td>${i.unit}</td>
        <td>${i.qty}</td>
        <td>${i.price}</td>
        <td>${row}</td>
      </tr>`;
  });
  total.innerText=t;
}

function saveSale(){
  if(items.length==0)return alert("ÙØ§ØªÙˆØ±Ø© ÙØ§Ø¶ÙŠØ©");

  if(paymentType.value=="credit" && !customerName.value)
    return alert("Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨");

  // Ø®ØµÙ… Ù…Ø®Ø²ÙˆÙ†
  items.forEach(i=>{
    let p=products.find(x=>x.name==i.name);
    p.stock[i.unit]-=i.qty;
  });

  sales.push({
    date:new Date().toLocaleString(),
    customer:customerName.value||"Ù†Ù‚Ø¯ÙŠ",
    agent:agentName.value,
    payment:paymentType.value,
    items,
    total:total.innerText
  });

  localStorage.setItem("sales",JSON.stringify(sales));
  localStorage.setItem("products",JSON.stringify(products));

  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
  items=[];
  render();
}
</script>

</body>
</html>
