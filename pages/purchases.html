<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</title>

<style>
body{margin:0;font-family:Tahoma;background:#f4f6f9}
.sidebar{
  position:fixed;right:0;top:0;width:260px;height:100vh;
  background:linear-gradient(180deg,#0f1f3a,#142850);
  padding:12px;color:#fff
}
.menu-item{
  display:flex;align-items:center;gap:10px;
  background:#1b2d4a;padding:14px;border-radius:14px;
  margin-bottom:10px;cursor:pointer
}
.menu-item:hover{background:#284b8f}
.main{margin-right:260px;padding:20px}
.card{
  background:#fff;padding:15px;border-radius:14px;margin-bottom:15px
}
.row{display:flex;gap:10px;flex-wrap:wrap}
input,select,button{
  padding:10px;border-radius:10px;border:1px solid #ccc
}
button{
  background:#2f6df6;color:#fff;border:none;cursor:pointer
}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#eee}
h2{margin-top:0}
</style>
</head>

<body>

<!-- ===== MENU ===== -->
<div class="sidebar">
  <div class="menu-item" onclick="go('sales.html')">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
  <div class="menu-item" onclick="go('products.html')">Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
  <div class="menu-item" onclick="go('purchases.html')">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
  <div class="menu-item" onclick="go('returns.html')">Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª</div>
  <div class="menu-item" onclick="go('customers.html')">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
  <div class="menu-item" onclick="go('suppliers.html')">Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</div>
  <div class="menu-item" onclick="go('stock.html')">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
  <div class="menu-item" onclick="go('reports.html')">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
  <div class="menu-item" onclick="go('settings.html')">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
</div>

<!-- ===== CONTENT ===== -->
<div class="main">

<h2>Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>

<!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
<div class="card">
  <div class="row">
    <input id="supplierName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯">
    <input type="date" id="purchaseDate">
  </div>
</div>

<!-- Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù -->
<div class="card">
  <input id="productName" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙ†Ù" list="productsList">
  <datalist id="productsList"></datalist>

  <div class="row">
    <select id="unit"></select>
    <input type="number" id="qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" value="1">
    <input type="number" id="cost" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
    <button onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
  </div>
</div>

<!-- Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
<div class="card">
  <button onclick="savePurchase()">ğŸ’¾ Ø­ÙØ¸</button>

  <table>
    <thead>
      <tr>
        <th>Ø§Ù„ØµÙ†Ù</th>
        <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
      </tr>
    </thead>
    <tbody id="invoice"></tbody>
  </table>

  <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0</span></h3>
</div>

</div>

<script>
function go(p){location.href=p;}
</script>

<script>
/************ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ************/
let products   = JSON.parse(localStorage.getItem("products")) || [];
let purchases  = JSON.parse(localStorage.getItem("purchases")) || [];

let items=[], total=0;

const productInput=document.getElementById("productName");
const unitSelect=document.getElementById("unit");
const qtyInput=document.getElementById("qty");
const costInput=document.getElementById("cost");
const invoice=document.getElementById("invoice");
const totalSpan=document.getElementById("total");
const list=document.getElementById("productsList");

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù
products.forEach(p=>{
  list.innerHTML+=`<option value="${p.name}">`;
});

// Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØµÙ†Ù
productInput.onchange=()=>{
  const p=products.find(x=>x.name===productInput.value);
  unitSelect.innerHTML="";
  if(!p)return;
  for(let u in p.units){
    unitSelect.innerHTML+=`<option>${u}</option>`;
  }
};

// Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù
function addItem(){
  const p=products.find(x=>x.name===productInput.value);
  if(!p)return alert("Ø§Ù„ØµÙ†Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");

  const u=unitSelect.value;
  const q=+qtyInput.value;
  const c=+costInput.value;
  if(q<=0||c<=0)return alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©");

  items.push({name:p.name,unit:u,qty:q,cost:c});
  render();
}

// Ø±Ø³Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©
function render(){
  invoice.innerHTML="";
  total=0;
  items.forEach(i=>{
    const r=i.qty*i.cost;
    total+=r;
    invoice.innerHTML+=`
      <tr>
        <td>${i.name}</td>
        <td>${i.unit}</td>
        <td>${i.qty}</td>
        <td>${i.cost}</td>
        <td>${r}</td>
      </tr>`;
  });
  totalSpan.innerText=total;
}

// Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
function savePurchase(){
  if(items.length===0)return alert("ÙØ§ØªÙˆØ±Ø© ÙØ§Ø¶ÙŠØ©");

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
  items.forEach(i=>{
    let p=products.find(x=>x.name===i.name);
    if(!p.units[i.unit]){
      p.units[i.unit]={price:0,stock:0};
    }
    p.units[i.unit].stock+=i.qty;
  });

  purchases.push({
    id:Date.now(),
    supplier:document.getElementById("supplierName").value,
    date:document.getElementById("purchaseDate").value,
    items,
    total
  });

  localStorage.setItem("products",JSON.stringify(products));
  localStorage.setItem("purchases",JSON.stringify(purchases));

  items=[];
  render();
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†");
}
</script>

</body>
</html>
