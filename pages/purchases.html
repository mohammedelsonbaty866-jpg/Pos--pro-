<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</title>

  <link rel="stylesheet" href="../css/menu.css">

  <style>
    body { background:#f4f6f9; }
    .page { padding:20px; }
    .card {
      background:#fff;
      padding:15px;
      border-radius:12px;
      margin-bottom:15px;
    }
    .row {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:10px;
    }
    input, select {
      padding:10px;
      border-radius:8px;
      border:1px solid #ccc;
      width:100%;
    }
    button {
      padding:10px;
      border:none;
      border-radius:8px;
      background:#2f6df6;
      color:#fff;
      cursor:pointer;
    }
    table {
      width:100%;
      border-collapse:collapse;
    }
    th,td {
      padding:8px;
      border-bottom:1px solid #ddd;
      text-align:center;
    }
    th { background:#f1f3f6; }
    .total {
      font-size:18px;
      font-weight:bold;
      text-align:left;
      margin-top:10px;
    }
  </style>
</head>

<body>

<!-- ===== Ø§Ù„Ù…Ù†ÙŠÙˆ ===== -->
<div class="sidebar" id="sidebar">
  <div class="menu-item" onclick="go('sales.html')">ğŸ§¾ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
  <div class="menu-item active">ğŸ“¦ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
  <div class="menu-item" onclick="go('items.html')">ğŸ“‹ Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
  <div class="menu-item" onclick="go('customers.html')">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
  <div class="menu-item" onclick="go('suppliers.html')">ğŸ­ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</div>
  <div class="menu-item" onclick="go('stock.html')">ğŸ“Š Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
  <div class="menu-item" onclick="go('reports.html')">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
  <div class="menu-item" onclick="go('settings.html')">âš™ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
  <div class="menu-toggle" onclick="toggleMenu()">â¬…</div>
</div>

<!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ===== -->
<div class="main-content">
<div class="page">

<h2>ğŸ“¦ Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>

<!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ -->
<div class="card">
  <div class="row">
    <input type="text" id="supplier" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯">
    <input type="number" id="discount" placeholder="Ø®ØµÙ…">
  </div>
</div>

<!-- Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù -->
<div class="card">
  <div class="row">
    <input type="text" id="itemName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
    <input type="number" id="qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
    <input type="number" id="buyPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
    <input type="number" id="sellPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
    <button onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
  </div>
</div>

<!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
<div class="card">
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Ø§Ù„ØµÙ†Ù</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø´Ø±Ø§Ø¡</th>
        <th>Ø¨ÙŠØ¹</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
        <th>âŒ</th>
      </tr>
    </thead>
    <tbody id="invoiceBody"></tbody>
  </table>

  <div class="total">
    Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0</span> Ø¬Ù†ÙŠÙ‡
  </div>

  <br>
  <button onclick="savePurchase()">ğŸ’¾ Ø­ÙØ¸</button>
  <button onclick="window.print()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
</div>

</div>
</div>

<script src="../js/menu.js"></script>

<script>
let invoice = [];
let total = 0;

function addItem() {
  const name = itemName.value.trim();
  const q = Number(qty.value);
  const buy = Number(buyPrice.value);
  const sell = Number(sellPrice.value);

  if (!name || q<=0 || buy<=0 || sell<=0)
    return alert("Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

  invoice.push({
    name,
    qty:q,
    buy,
    sell,
    total:q*buy
  });

  render();
}

function render() {
  invoiceBody.innerHTML="";
  total=0;

  invoice.forEach((i,idx)=>{
    total+=i.total;
    invoiceBody.innerHTML+=`
      <tr>
        <td>${idx+1}</td>
        <td>${i.name}</td>
        <td>${i.qty}</td>
        <td>${i.buy}</td>
        <td>${i.sell}</td>
        <td>${i.total}</td>
        <td><button onclick="removeItem(${idx})">âŒ</button></td>
      </tr>
    `;
  });

  total -= Number(discount.value||0);
  document.getElementById("total").innerText=total;
}

function removeItem(i){
  invoice.splice(i,1);
  render();
}

function savePurchase(){
  if(invoice.length===0) return alert("Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙØ§Ø¶ÙŠØ©");

  // Ø­ÙØ¸ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
  const purchases=JSON.parse(localStorage.getItem("purchases"))||[];
  purchases.push({
    id:Date.now(),
    supplier:supplier.value||"-",
    items:invoice,
    total,
    date:new Date().toLocaleString()
  });
  localStorage.setItem("purchases",JSON.stringify(purchases));

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ØµÙ†Ø§Ù + Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
  let items=JSON.parse(localStorage.getItem("items"))||[];
  let stock=JSON.parse(localStorage.getItem("stock"))||{};

  invoice.forEach(i=>{
    let item=items.find(x=>x.name===i.name);
    if(item){
      item.buyPrice=i.buy;
      item.price=i.sell; // Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹
    }else{
      items.push({
        name:i.name,
        buyPrice:i.buy,
        price:i.sell
      });
    }
    stock[i.name]=(stock[i.name]||0)+i.qty;
  });

  localStorage.setItem("items",JSON.stringify(items));
  localStorage.setItem("stock",JSON.stringify(stock));

  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†");

  invoice=[];
  render();
}
</script>

</body>
</html>
